const a1_0x2cdc=['__esModule','MessageReporter','../../api/error-reporter.api','printMessages','CloudEnabledLifeCycle','cloudEnabledTasksRunner','parseCommand','Agent\x20wasn\x27t\x20able\x20to\x20store\x20artifacts','../../file-storage/file-storage','rxjs/internal/Subject','throw','join','getMachineInfo','error','scan','endRun','../../../utilities/metric-logger','next','../../terminal-output/end-of-run-message','startRun','anyErrors','forEach','tasks-hashes-','requests','map','Agent\x20wasn\x27t\x20able\x20to\x20record\x20its\x20run','__awaiter','cacheableOperations','assign','value','maskedProperties','path','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','VERBOSE_LOGGING','../../terminal-output/message-reporter','env','FileStorage','cacheDirectory','NX_CLOUD_DISTRIBUTED_EXECUTION_ID','waitForStoreRequestsToComplete','exit','skipNxCache','then','hash','subscribe','encryptionKey','./node_modules/.cache/nx','ErrorReporterApi','submitRunMetrics','getBranch','writeFileSync','printCacheHitsMessage','OutputObfuscator','note','./cloud-remote-cache','filter','defineProperty','toISOString','catch','AGENT_RUNNING_IN_DISTRIBUTED_EXECUTION','all','CloudRemoteCache','../../../utilities/nx-imports','CloudRunApi'];(function(_0x18c2a4,_0x2cdc78){const _0x37b19d=function(_0x288905){while(--_0x288905){_0x18c2a4['push'](_0x18c2a4['shift']());}};_0x37b19d(++_0x2cdc78);}(a1_0x2cdc,0xcc));const a1_0x37b1=function(_0x18c2a4,_0x2cdc78){_0x18c2a4=_0x18c2a4-0x0;let _0x37b19d=a1_0x2cdc[_0x18c2a4];return _0x37b19d;};'use strict';var __awaiter=this&&this[a1_0x37b1('0xe')]||function(_0x259295,_0x10ecd4,_0x3926b2,_0x345b45){function _0x52f00e(_0x44c715){return _0x44c715 instanceof _0x3926b2?_0x44c715:new _0x3926b2(function(_0x55cc67){_0x55cc67(_0x44c715);});}return new(_0x3926b2||(_0x3926b2=Promise))(function(_0x5c4d97,_0x507cee){function _0x5e0a81(_0x31215e){try{_0x57cf46(_0x345b45['next'](_0x31215e));}catch(_0x30de50){_0x507cee(_0x30de50);}}function _0x3c23e2(_0x49dcac){try{_0x57cf46(_0x345b45[a1_0x37b1('0x3e')](_0x49dcac));}catch(_0x2aad1a){_0x507cee(_0x2aad1a);}}function _0x57cf46(_0x58ad41){_0x58ad41['done']?_0x5c4d97(_0x58ad41[a1_0x37b1('0x11')]):_0x52f00e(_0x58ad41['value'])['then'](_0x5e0a81,_0x3c23e2);}_0x57cf46((_0x345b45=_0x345b45['apply'](_0x259295,_0x10ecd4||[]))[a1_0x37b1('0x5')]());});};Object[a1_0x37b1('0x2c')](exports,a1_0x37b1('0x34'),{'value':!![]});exports['cloudEnabledTasksRunner']=void 0x0;const message_reporter_1=require(a1_0x37b1('0x16'));const end_of_run_message_1=require(a1_0x37b1('0x6'));const output_obfuscator_1=require('../../terminal-output/output-obfuscator');const cloud_enabled_life_cycle_1=require('./cloud-enabled-life-cycle');const file_storage_1=require(a1_0x37b1('0x3c'));const e2e_encryption_1=require('../../file-storage/e2e-encryption');const environment_1=require('../../../utilities/environment');const cloud_remote_cache_1=require(a1_0x37b1('0x2a'));const cloud_run_api_1=require('./cloud-run.api');const fs_1=require('fs');const path=require(a1_0x37b1('0x13'));const metric_logger_1=require(a1_0x37b1('0x4'));const error_reporter_api_1=require(a1_0x37b1('0x36'));const {tasksRunner,output}=require(a1_0x37b1('0x32'));function createApi(_0x2f6fab,_0x284d31,_0x12403e){const _0x389b49=(0x0,environment_1[a1_0x37b1('0x0')])(_0x284d31);return new cloud_run_api_1[(a1_0x37b1('0x33'))](_0x2f6fab,_0x12403e,_0x284d31,_0x389b49);}function storeTaskHashes(_0x2c2514,_0x14d38b,_0x3a6b97){const _0x598236=JSON['stringify'](_0x2c2514[a1_0x37b1('0xc')](_0x190100=>({'taskId':_0x190100['taskId'],'hash':_0x190100[a1_0x37b1('0x1f')]})));if(environment_1[a1_0x37b1('0x15')]){output[a1_0x37b1('0x29')]({'title':'Executed\x20tasks\x20with\x20hashes:\x20'+_0x598236});}(0x0,fs_1[a1_0x37b1('0x26')])(path[a1_0x37b1('0x3f')](_0x14d38b,a1_0x37b1('0xa')+_0x3a6b97),_0x598236);}function onComplete(_0x2496b9,_0x4d3d3e,_0x1157ac,_0x138ba7,_0x101c2e,_0x359a57,_0x17ef4b,_0x1fdff0,_0x555c0f,_0x5dea38,_0x526b3){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x2a65a6=new Date()[a1_0x37b1('0x2d')]();if(environment_1[a1_0x37b1('0x2f')]){storeTaskHashes(_0x555c0f,_0x4d3d3e[a1_0x37b1('0x19')]||a1_0x37b1('0x22'),environment_1['NX_CLOUD_DISTRIBUTED_EXECUTION_ID']);}const _0x1bb900=(0x0,environment_1[a1_0x37b1('0x25')])();const _0x316524=yield Promise[a1_0x37b1('0x30')]([_0x1157ac[a1_0x37b1('0x1b')](),_0x138ba7[a1_0x37b1('0x3')]({'command':_0x101c2e['obfuscate']((0x0,environment_1[a1_0x37b1('0x3a')])()),'startTime':_0x359a57,'endTime':_0x2a65a6,'distributedExecutionId':environment_1[a1_0x37b1('0x1a')],'branch':_0x1bb900,'scan':!![],'runGroup':(0x0,environment_1['getRunGroup'])(),'sha':_0x1bb900?(0x0,environment_1['extractGitSha'])():undefined,'inner':_0x526b3},_0x555c0f)]);if(_0x5dea38){setTimeout(()=>{_0x17ef4b[a1_0x37b1('0x37')]();if(!_0x17ef4b[a1_0x37b1('0x8')]&&!_0x526b3){_0x1fdff0[a1_0x37b1('0x27')]();}},0x0);}else{_0x17ef4b[a1_0x37b1('0x37')]();if(!_0x17ef4b['anyErrors']&&!_0x526b3){_0x1fdff0[a1_0x37b1('0x27')]();}}if(environment_1[a1_0x37b1('0x2f')]){if(!_0x316524[0x0]){output['error']({'title':a1_0x37b1('0x3b')});_0x17ef4b[a1_0x37b1('0x37')]();process[a1_0x37b1('0x1c')](environment_1['DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE']);}if(!_0x316524[0x1]){output[a1_0x37b1('0x1')]({'title':a1_0x37b1('0xd')});_0x17ef4b[a1_0x37b1('0x37')]();process[a1_0x37b1('0x1c')](environment_1[a1_0x37b1('0x14')]);}}yield(0x0,metric_logger_1[a1_0x37b1('0x24')])(_0x4d3d3e);});}function createLifeCycle(_0x12cb69,_0xd76b85,_0x124785,_0x439e7d){const _0x3d9b7a=new cloud_enabled_life_cycle_1[(a1_0x37b1('0x38'))](_0x12cb69,_0xd76b85[a1_0x37b1('0x19')],!!_0xd76b85[a1_0x37b1('0x1d')],_0xd76b85[a1_0x37b1('0x2')]===undefined?!![]:_0xd76b85[a1_0x37b1('0x2')],_0xd76b85[a1_0x37b1('0xf')]||[],_0x124785,_0x439e7d);try{const {CompositeLifeCycle}=require(a1_0x37b1('0x32'));if(!CompositeLifeCycle)return _0x3d9b7a;return new CompositeLifeCycle([_0xd76b85['lifeCycle'],_0x3d9b7a]);}catch(_0x8a018d){return _0x3d9b7a;}}function cloudEnabledTasksRunner(_0x4684a4,_0x3b96a5,_0x5f09c1,_0x27ae46=![]){const _0x252ef4={'statuses':{},'scheduledTasks':[],'requests':{},'allTasks':_0x4684a4};const _0x40f69c=_0x3b96a5['lifeCycle']===undefined;const _0x4d6b5f=[];const _0x425cea=new message_reporter_1[(a1_0x37b1('0x35'))](_0x3b96a5);const _0x1c4ee4=createApi(_0x425cea,_0x3b96a5,_0x252ef4);const _0x3fccb3=new end_of_run_message_1['EndOfRunMessage'](_0x252ef4,_0x4d6b5f);const _0x48d8f9=new output_obfuscator_1[(a1_0x37b1('0x28'))](_0x3b96a5[a1_0x37b1('0x12')]);const _0x83f283=_0x4684a4[a1_0x37b1('0xc')](_0x23a912=>_0x23a912[a1_0x37b1('0x1f')])[a1_0x37b1('0x2b')](_0xe8d1f3=>!!_0xe8d1f3);const _0x6c1163=_0x1c4ee4[a1_0x37b1('0x7')](environment_1[a1_0x37b1('0x1a')],_0x83f283);_0x83f283[a1_0x37b1('0x9')](_0x405303=>{_0x252ef4[a1_0x37b1('0xb')][_0x405303]=_0x6c1163;});const _0x53cdfb=new Date()['toISOString']();const _0xaa1b0f=createLifeCycle(_0x252ef4,_0x3b96a5,_0x48d8f9,_0x4d6b5f);const _0x9c5002=new e2e_encryption_1['E2EEncryption'](environment_1['ENCRYPTION_KEY']||_0x3b96a5[a1_0x37b1('0x21')]);const _0x1218c8=new error_reporter_api_1[(a1_0x37b1('0x23'))](_0x3b96a5);const _0x636620=new file_storage_1[(a1_0x37b1('0x18'))](_0x9c5002,_0x1218c8,![]);const _0x257576=new cloud_remote_cache_1[(a1_0x37b1('0x31'))](_0x425cea,_0x1c4ee4,_0x252ef4,_0x636620);delete process[a1_0x37b1('0x17')][a1_0x37b1('0x1a')];const _0x3ccfed=tasksRunner(_0x4684a4,Object[a1_0x37b1('0x10')](Object[a1_0x37b1('0x10')]({},_0x3b96a5),{'remoteCache':_0x257576,'lifeCycle':_0xaa1b0f}),_0x5f09c1);if(_0x3ccfed['subscribe']){const {Subject}=require(a1_0x37b1('0x3d'));const _0x66ae8b=new Subject();_0x3ccfed[a1_0x37b1('0x20')]({'next':_0x3004a2=>_0x66ae8b[a1_0x37b1('0x5')](_0x3004a2),'error':_0x11108e=>_0x66ae8b['error'](_0x11108e),'complete':()=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete(_0xaa1b0f,_0x3b96a5,_0x257576,_0x1c4ee4,_0x48d8f9,_0x53cdfb,_0x425cea,_0x3fccb3,_0x4d6b5f,_0x40f69c,_0x27ae46);_0x66ae8b['complete']();})});return _0x66ae8b;}else{return _0x3ccfed[a1_0x37b1('0x1e')](_0x1612fd=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete(_0xaa1b0f,_0x3b96a5,_0x257576,_0x1c4ee4,_0x48d8f9,_0x53cdfb,_0x425cea,_0x3fccb3,_0x4d6b5f,_0x40f69c,_0x27ae46);return _0x1612fd;}))[a1_0x37b1('0x2e')](_0x56a356=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete(_0xaa1b0f,_0x3b96a5,_0x257576,_0x1c4ee4,_0x48d8f9,_0x53cdfb,_0x425cea,_0x3fccb3,_0x4d6b5f,_0x40f69c,_0x27ae46);throw _0x56a356;}));}}exports[a1_0x37b1('0x39')]=cloudEnabledTasksRunner;