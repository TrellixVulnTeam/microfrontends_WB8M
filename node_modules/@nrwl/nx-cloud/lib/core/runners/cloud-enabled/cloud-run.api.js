const a3_0x3394=['value','terminalOutput','map','stack','extractErrorMessage','createMetricRecorder','toString','createApiAxiosInstance','urls','Run\x20completion\x20responded\x20with\x20`undefined`.','package.json','message','CloudRunApi','RUNNER_FAILURE_PERF_ENTRY','string','apiError','then','createReqBody','promisify','note','Invalid\x20end\x20run\x20response','axiosMultipleTries','response','gzip','status','getRunGroup','error','application/octet-stream','../../../utilities/nx-imports','../../../utilities/metric-logger','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','devDependencies','endRun','nxCloudVersion','headers','apply','getBranch','assign','data','mapRespToPerfEntry','defineProperty','__esModule','Invalid\x20Nx\x20Cloud\x20response:\x20','defaults','zlib','util','/nx-cloud/runs/start','done','Run\x20Details:','post','../../../utilities/axios','runContext','startRun','messages','slice','apiAxiosInstance','Invalid\x20end\x20run\x20response:\x20','next','stringify','VERBOSE_LOGGING','RunEnd.\x20Completed\x20tasks','recordMetric','machineInfo','runUrl','readFileSync','success','axiosException'];(function(_0x537c27,_0x339476){const _0x374253=function(_0x5dea17){while(--_0x5dea17){_0x537c27['push'](_0x537c27['shift']());}};_0x374253(++_0x339476);}(a3_0x3394,0x1c3));const a3_0x3742=function(_0x537c27,_0x339476){_0x537c27=_0x537c27-0x0;let _0x374253=a3_0x3394[_0x537c27];return _0x374253;};'use strict';var __awaiter=this&&this['__awaiter']||function(_0x9563ee,_0x367bdf,_0x38cbe4,_0x2cbb68){function _0xa56ee7(_0x730bbb){return _0x730bbb instanceof _0x38cbe4?_0x730bbb:new _0x38cbe4(function(_0x3d9e09){_0x3d9e09(_0x730bbb);});}return new(_0x38cbe4||(_0x38cbe4=Promise))(function(_0x4b493d,_0x44cb06){function _0x5cca49(_0xd94774){try{_0x5dcb2f(_0x2cbb68[a3_0x3742('0x8')](_0xd94774));}catch(_0x12613b){_0x44cb06(_0x12613b);}}function _0x58d431(_0x3274aa){try{_0x5dcb2f(_0x2cbb68['throw'](_0x3274aa));}catch(_0x3afc42){_0x44cb06(_0x3afc42);}}function _0x5dcb2f(_0x5be5cb){_0x5be5cb[a3_0x3742('0x41')]?_0x4b493d(_0x5be5cb[a3_0x3742('0x12')]):_0xa56ee7(_0x5be5cb['value'])[a3_0x3742('0x22')](_0x5cca49,_0x58d431);}_0x5dcb2f((_0x2cbb68=_0x2cbb68[a3_0x3742('0x35')](_0x9563ee,_0x367bdf||[]))[a3_0x3742('0x8')]());});};Object[a3_0x3742('0x3a')](exports,a3_0x3742('0x3b'),{'value':!![]});exports[a3_0x3742('0x1e')]=void 0x0;const axios_1=require(a3_0x3742('0x1'));const environment_1=require('../../../utilities/environment');const fs_1=require('fs');const zlib_1=require(a3_0x3742('0x3e'));const util_1=require(a3_0x3742('0x3f'));const metric_logger_1=require(a3_0x3742('0x2f'));const {output}=require(a3_0x3742('0x2e'));class CloudRunApi{constructor(_0x3ce4e0,_0x51bf83,_0x1185cb,_0x59a56d){this[a3_0x3742('0x4')]=_0x3ce4e0;this[a3_0x3742('0x2')]=_0x51bf83;this[a3_0x3742('0xd')]=_0x59a56d;this[a3_0x3742('0x6')]=(0x0,axios_1[a3_0x3742('0x19')])(_0x1185cb);}[a3_0x3742('0x3')](_0xa19cc0,_0x13a98a){var _0x54b05;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x6c8d53=(0x0,metric_logger_1[a3_0x3742('0x17')])(a3_0x3742('0x3'));try{const _0x429337={'meta':{'nxCloudVersion':this[a3_0x3742('0x33')]()},'branch':(0x0,environment_1[a3_0x3742('0x36')])(),'runGroup':(0x0,environment_1[a3_0x3742('0x2b')])(),'distributedExecutionId':_0xa19cc0,'hashes':_0x13a98a};if(environment_1['VERBOSE_LOGGING']){output[a3_0x3742('0x25')]({'title':'RunStart','bodyLines':['\x0a'+JSON[a3_0x3742('0x9')](_0x429337,null,0x2)]});}const _0x3c213e=yield(0x0,axios_1['axiosMultipleTries'])(()=>this[a3_0x3742('0x6')]['post'](a3_0x3742('0x40'),_0x429337));_0x6c8d53[a3_0x3742('0xc')]((0x0,metric_logger_1['mapRespToPerfEntry'])(_0x3c213e));if(_0x3c213e[a3_0x3742('0x38')]&&_0x3c213e[a3_0x3742('0x38')][a3_0x3742('0x1d')]){this[a3_0x3742('0x4')][a3_0x3742('0x1d')]=_0x3c213e[a3_0x3742('0x38')][a3_0x3742('0x1d')];}if(!_0x3c213e['data']||!_0x3c213e[a3_0x3742('0x38')][a3_0x3742('0x1a')]){this[a3_0x3742('0x4')][a3_0x3742('0x21')]=a3_0x3742('0x3c')+JSON[a3_0x3742('0x9')](_0x3c213e[a3_0x3742('0x38')]);return{};}return _0x3c213e['data'][a3_0x3742('0x1a')];}catch(_0x2b50a8){_0x6c8d53[a3_0x3742('0xc')](((_0x54b05=_0x2b50a8===null||_0x2b50a8===void 0x0?void 0x0:_0x2b50a8[a3_0x3742('0x11')])===null||_0x54b05===void 0x0?void 0x0:_0x54b05[a3_0x3742('0x28')])?(0x0,metric_logger_1[a3_0x3742('0x39')])(_0x2b50a8['axiosException']['response']):metric_logger_1['RUNNER_FAILURE_PERF_ENTRY']);this[a3_0x3742('0x4')][a3_0x3742('0x21')]=this[a3_0x3742('0x4')][a3_0x3742('0x16')](_0x2b50a8,'api');return{};}});}[a3_0x3742('0x23')](_0x49d6ec,_0x40b910){const _0x4b7a40={'meta':{'nxCloudVersion':this[a3_0x3742('0x33')]()},'tasks':_0x40b910,'run':_0x49d6ec,'machineInfo':this[a3_0x3742('0xd')]};return JSON[a3_0x3742('0x9')](_0x4b7a40);}[a3_0x3742('0x32')](_0x219808,_0x5a5f81){var _0x17c109,_0x3f30a0;return __awaiter(this,void 0x0,void 0x0,function*(){if(this['messages'][a3_0x3742('0x21')])return![];let _0x53fce7=this[a3_0x3742('0x23')](_0x219808,_0x5a5f81);if(_0x53fce7['length']>0x14*0x3e8*0x3e8){_0x53fce7=this[a3_0x3742('0x23')](_0x219808,_0x5a5f81[a3_0x3742('0x14')](_0x2022dd=>Object[a3_0x3742('0x37')](Object[a3_0x3742('0x37')]({},_0x2022dd),{'hashDetails':undefined})));}const _0x5a23da=Buffer['from'](_0x53fce7);const _0x25877f=yield(0x0,util_1[a3_0x3742('0x24')])(zlib_1[a3_0x3742('0x29')])(_0x5a23da);const _0x46f006=(0x0,metric_logger_1[a3_0x3742('0x17')])('endRun');try{if(environment_1[a3_0x3742('0xa')]){const _0x401c19=_0x5a5f81['map'](_0x5b239a=>{return Object['assign'](Object[a3_0x3742('0x37')]({},_0x5b239a),{'terminalOutput':_0x5b239a[a3_0x3742('0x13')]?_0x5b239a[a3_0x3742('0x13')][a3_0x3742('0x5')](0x0,0x14)+'...':undefined});});output[a3_0x3742('0x25')]({'title':a3_0x3742('0xb'),'bodyLines':['\x0a'+JSON[a3_0x3742('0x9')](_0x401c19,null,0x2)]});}const _0x8bb54e=yield(0x0,axios_1[a3_0x3742('0x27')])(()=>this['apiAxiosInstance'][a3_0x3742('0x0')]('/nx-cloud/runs/end',_0x25877f,{'headers':Object['assign'](Object[a3_0x3742('0x37')]({},this['apiAxiosInstance'][a3_0x3742('0x3d')][a3_0x3742('0x34')]),{'Content-Encoding':'gzip','Content-Type':a3_0x3742('0x2d')})}));if(_0x8bb54e){_0x46f006[a3_0x3742('0xc')]((0x0,metric_logger_1[a3_0x3742('0x39')])(_0x8bb54e));if(_0x8bb54e[a3_0x3742('0x38')]&&_0x8bb54e['data'][a3_0x3742('0xe')]&&_0x8bb54e['data']['status']===a3_0x3742('0x10')){this[a3_0x3742('0x2')][a3_0x3742('0xe')]=_0x8bb54e[a3_0x3742('0x38')]['runUrl'];return!![];}if(_0x8bb54e['data']&&_0x8bb54e[a3_0x3742('0x38')][a3_0x3742('0x2a')]){this['messages'][a3_0x3742('0x21')]='Invalid\x20end\x20run\x20response:\x20'+JSON[a3_0x3742('0x9')](_0x8bb54e['data']['message']);}else if(_0x8bb54e[a3_0x3742('0x38')]&&typeof _0x8bb54e['data']===a3_0x3742('0x20')){if(_0x8bb54e[a3_0x3742('0x38')]!==a3_0x3742('0x10')){this['messages'][a3_0x3742('0x21')]=a3_0x3742('0x7')+JSON[a3_0x3742('0x9')](_0x8bb54e[a3_0x3742('0x38')]);}}else{this[a3_0x3742('0x4')]['apiError']='Invalid\x20end\x20run\x20response:\x20'+JSON['stringify'](_0x8bb54e['data']);}if(environment_1['VERBOSE_LOGGING']){output[a3_0x3742('0x25')]({'title':a3_0x3742('0x26'),'bodyLines':[JSON[a3_0x3742('0x9')](_0x8bb54e[a3_0x3742('0x38')],null,0x2)]});}}else{output[a3_0x3742('0x2c')]({'title':a3_0x3742('0x30'),'bodyLines':[a3_0x3742('0x1b'),a3_0x3742('0x42'),JSON[a3_0x3742('0x9')](_0x219808,null,0x2),'Stack\x20Trace:',JSON[a3_0x3742('0x9')](new Error()[a3_0x3742('0x15')],null,0x2)]});}return![];}catch(_0x4ea326){_0x46f006[a3_0x3742('0xc')](((_0x17c109=_0x4ea326===null||_0x4ea326===void 0x0?void 0x0:_0x4ea326[a3_0x3742('0x11')])===null||_0x17c109===void 0x0?void 0x0:_0x17c109[a3_0x3742('0x28')])?(0x0,metric_logger_1[a3_0x3742('0x39')])(_0x4ea326[a3_0x3742('0x11')][a3_0x3742('0x28')]):metric_logger_1[a3_0x3742('0x1f')]);const _0x4b41da=(_0x3f30a0=_0x4ea326[a3_0x3742('0x11')])!==null&&_0x3f30a0!==void 0x0?_0x3f30a0:_0x4ea326;this[a3_0x3742('0x4')][a3_0x3742('0x21')]=this[a3_0x3742('0x4')][a3_0x3742('0x16')](_0x4b41da,'api');return![];}});}[a3_0x3742('0x33')](){try{const _0x5af60b=JSON['parse']((0x0,fs_1[a3_0x3742('0xf')])(a3_0x3742('0x1c'))[a3_0x3742('0x18')]());return _0x5af60b[a3_0x3742('0x31')]['@nrwl/nx-cloud'];}catch(_0x16feab){return'unknown';}}}exports[a3_0x3742('0x1e')]=CloudRunApi;